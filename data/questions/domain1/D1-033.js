window.DOMAIN1_QUESTIONS = window.DOMAIN1_QUESTIONS || [];
window.DOMAIN1_QUESTIONS.push({
  "id": "D1-033",
  "domain": 1,
  "task": "1.4",
  "skill": "1.4.2",
  "type": "single",
  "difficulty": "medium",
  "question": "ある医療機器メーカーが、Amazon Bedrock ナレッジベースを使用して、規制文書・臨床試験報告・製品マニュアルを対象とした社内RAGシステムを構築しています。ユーザーが検索する際に、文書の種別（規制文書/臨床試験/マニュアル）、機密レベル（公開/社内限定/極秘）、および発行年で検索結果を絞り込む必要があります。また、機密レベルに応じてユーザーのアクセス権限で表示結果を制限する必要があります。最も運用負荷が低く効果的なアーキテクチャはどれですか？",
  "options": [
    {
      "id": "A",
      "text": "各ドキュメントに対応する .metadata.json ファイルを S3 の同じプレフィックスに配置し、文書種別・機密レベル・発行年をメタデータ属性として定義する。Bedrock ナレッジベースの RetrieveAndGenerate API でメタデータフィルターを指定し、アプリケーション層でユーザーの権限に応じたフィルター条件を動的に構成する"
    },
    {
      "id": "B",
      "text": "メタデータ（文書種別・機密レベル・発行年）をドキュメント本文の先頭に「[種別:規制文書][機密:社内限定][発行:2024]」の形式で埋め込み、ベクトル化する。検索時にメタデータキーワードをクエリに追加してセマンティック検索で絞り込む"
    },
    {
      "id": "C",
      "text": "DynamoDB テーブルに文書IDをキーとしてメタデータを保存し、Lambda 関数でまず DynamoDB からメタデータ条件に合致する文書IDリストを取得した後、Bedrock ナレッジベースの Retrieve API で各文書IDを個別に検索して結果を統合する"
    },
    {
      "id": "D",
      "text": "S3 オブジェクトタグに文書種別・機密レベル・発行年を設定し、S3 Select でタグ条件に合致するオブジェクトを事前フィルタリングしてから、対象ドキュメントのみで Bedrock ナレッジベースの同期を実行する"
    }
  ],
  "correctAnswers": [
    "A"
  ],
  "explanation": "Bedrock ナレッジベースは、各ドキュメントに対応する .metadata.json ファイルで定義された属性を使用して、RetrieveAndGenerate / Retrieve API のメタデータフィルター機能でベクトル検索と同時にフィルタリングを実行できます。アプリケーション層でユーザー権限に応じたフィルター条件を動的に構成すれば、機密レベルによるアクセス制御も実現できます。メタデータを本文に埋め込む方法（B）は、メタデータのトークンがベクトル表現を汚染し、「規制文書」というテキストが意味的検索に干渉して関連性スコアが歪みます。また、メタデータ値の完全一致フィルタリングが保証されません。DynamoDB + 個別検索（C）は、メタデータの事前フィルタリングと Bedrock 検索が分離されるため、文書IDごとの個別検索によるAPIコール数の増大とレイテンシーの増加が発生し、運用負荷が高くなります。S3 オブジェクトタグ（D）はS3のライフサイクルポリシーやアクセス制御と連動する機能であり、Bedrock ナレッジベースのメタデータフィルタリングには使用できません。また、タグ条件でナレッジベースの同期対象を動的に制御する機能もありません。（スキル1.4.2）",
  "optionExplanations": {
    "A": {
      "correct": true,
      "text": "正解です。.metadata.json ファイルと Bedrock ナレッジベースのメタデータフィルター機能の組み合わせは、ベクトル検索と属性フィルタリングの同時実行を Bedrock ネイティブの機能で実現し、運用負荷が最も低くなります。アプリケーション層での動的フィルター構成により、機密レベルに応じたアクセス制御も実現できます。"
    },
    "B": {
      "correct": false,
      "text": "不正解です。メタデータを本文に埋め込むとベクトル表現が汚染され、「規制文書」等のメタデータトークンが意味的検索に干渉して関連性スコアが歪みます。また、セマンティック検索ではメタデータ値の完全一致フィルタリングが保証されず、機密レベルによる厳密なアクセス制御の要件を満たせません。"
    },
    "C": {
      "correct": false,
      "text": "不正解です。DynamoDB でのメタデータ管理と Bedrock 検索の分離アーキテクチャは機能的には実現可能ですが、文書IDごとの個別API呼び出しによるレイテンシー増大と、2つのデータソース間の整合性管理が必要になり、Bedrock ネイティブのメタデータフィルタリングと比較して運用負荷が大幅に増加します。"
    },
    "D": {
      "correct": false,
      "text": "不正解です。S3 オブジェクトタグはS3のライフサイクルポリシーやバケットポリシーと連動するストレージ管理機能であり、Bedrock ナレッジベースの検索時メタデータフィルタリングには使用できません。検索時にリアルタイムでフィルタリング条件を指定するには .metadata.json ファイルによるメタデータ定義が必要です。"
    }
  },
  "references": [
    {
      "title": "Amazon Bedrock ナレッジベースのメタデータ",
      "url": "https://docs.aws.amazon.com/bedrock/latest/userguide/knowledge-base-ds.html"
    }
  ]
});
