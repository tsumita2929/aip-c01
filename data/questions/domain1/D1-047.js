window.DOMAIN1_QUESTIONS = window.DOMAIN1_QUESTIONS || [];
window.DOMAIN1_QUESTIONS.push({
  "id": "D1-047",
  "domain": 1,
  "task": "1.5",
  "skill": "1.5.4",
  "type": "single",
  "difficulty": "hard",
  "question": "ある法律事務所が、Amazon Bedrock ナレッジベースを使用して、20年分・10万件の判例・契約書・法令文書を対象とした RAG システムを構築しています。弁護士のクエリには2つの特徴があります：(1)「民法第709条」「善管注意義務」のような法律用語の正確な完全一致検索が必要なケース、(2)「過失相殺における責任割合の判断基準」のような意味的な類似性検索が必要なケース。両方のケースで高精度な検索結果を返し、かつ運用チームの管理負荷を最小化するアーキテクチャはどれですか？",
  "options": [
    {
      "id": "A",
      "text": "OpenSearch Serverless をベクトルストアとして使用し、ハイブリッド検索を構成する。BM25 スコア（キーワード完全一致）と k-NN スコア（ベクトル類似度）をmin-max正規化で統合し、法律用語の重みを高めた重み付け設定で最終ランキングを生成する"
    },
    {
      "id": "B",
      "text": "OpenSearch Serverless のベクトル検索コレクションと、Amazon Kendra のインデックスを並列に構成する。ベクトル検索は OpenSearch で、キーワード検索は Kendra で実行し、Lambda 関数で両方の結果を Reciprocal Rank Fusion（RRF）でマージして FM に送信する"
    },
    {
      "id": "C",
      "text": "OpenSearch Serverless のベクトル検索のみを使用し、クエリ前処理で FM に法律用語を検出させ、検出された用語をメタデータフィルターの条件に変換してベクトル検索と同時にフィルタリングする"
    },
    {
      "id": "D",
      "text": "Amazon Kendra Enterprise Edition を単独で使用し、Kendra のセマンティック検索機能で意味的な類似性検索を行い、キーワード検索は Kendra のファセット検索で対応する。Kendra の結果を Bedrock FM に送信して回答を生成する"
    }
  ],
  "correctAnswers": [
    "A"
  ],
  "explanation": "OpenSearch Serverless のハイブリッド検索は、同一インデックス上で BM25（キーワード完全一致）と k-NN（ベクトル類似度検索）を統合的に実行し、スコアの正規化と重み付けにより両方の検索手法の結果を最適に統合します。「民法第709条」のような法律用語はBM25の完全一致スコアが高くなり、「過失相殺における責任割合の判断基準」のような意味的クエリはk-NNスコアが高くなり、両方のケースで適切なランキングを返します。単一のマネージドサービス上で完結するため運用負荷も最小限です。OpenSearch + Kendra 並列構成（B）は両方の検索手法を使用できますが、2つの検索基盤（OpenSearch コレクション + Kendra インデックス）の管理と、Lambda によるスコア統合ロジックの開発・保守が必要で、運用負荷が大幅に増加します。ベクトル検索 + メタデータフィルター（C）はメタデータフィルターでの絞り込みが可能ですが、メタデータフィルターは事前に定義された属性値での完全一致フィルタリングであり、「民法第709条」のような本文中のキーワード完全一致検索とは異なります。すべての法律用語を事前にメタデータとして登録することは現実的ではありません。Kendra 単独（D）はセマンティック検索を提供しますが、Bedrock ナレッジベースのベクトルストアとして直接統合できず、ベクトル検索のパラメータ（次元数、距離メトリクス、HNSW パラメータ等）の細かな最適化ができません。また、ファセット検索はメタデータのカテゴリ分類であり、本文中の法律用語の完全一致検索とは異なります。（スキル1.5.4）",
  "optionExplanations": {
    "A": {
      "correct": true,
      "text": "正解です。OpenSearch Serverless のハイブリッド検索は、BM25（キーワード完全一致）と k-NN（ベクトル類似度）の統合ランキングを単一のマネージドサービス上で提供し、法律用語の完全一致と意味的類似性の両方の検索要件を最小の運用負荷で満たします。"
    },
    "B": {
      "correct": false,
      "text": "不正解です。OpenSearch + Kendra の並列構成は両方の検索手法を使用できますが、2つの検索基盤の管理と Lambda によるスコア統合ロジックの開発・保守が必要で、運用負荷の最小化要件を満たせません。"
    },
    "C": {
      "correct": false,
      "text": "不正解です。メタデータフィルターは事前定義された属性値での絞り込みであり、本文中の法律用語の完全一致検索とは異なります。すべての法律用語をメタデータとして事前登録することは現実的ではなく、キーワード検索の要件を満たせません。"
    },
    "D": {
      "correct": false,
      "text": "不正解です。Kendra のファセット検索はメタデータのカテゴリ分類であり、本文中の法律用語の完全一致検索ではありません。また、Bedrock ナレッジベースのベクトルストアとして直接統合できず、ベクトル検索パラメータの最適化もできないため、検索精度とアーキテクチャ統合の要件を満たせません。"
    }
  },
  "references": [
    {
      "title": "Amazon OpenSearch Service ハイブリッド検索",
      "url": "https://docs.aws.amazon.com/opensearch-service/latest/developerguide/knn.html"
    },
    {
      "title": "Amazon Bedrock ナレッジベース",
      "url": "https://docs.aws.amazon.com/bedrock/latest/userguide/knowledge-base.html"
    }
  ]
});
