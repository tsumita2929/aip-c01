window.DOMAIN1_QUESTIONS = window.DOMAIN1_QUESTIONS || [];
window.DOMAIN1_QUESTIONS.push({
  "id": "D1-046",
  "domain": 1,
  "task": "1.5",
  "skill": "1.5.3",
  "type": "multiple",
  "difficulty": "medium",
  "question": "ある eコマース企業が、Amazon Bedrock ナレッジベースのベクトルストアとして Aurora PostgreSQL Serverless v2（pgvector 拡張）を使用し、30万件の商品情報ドキュメントに対するセマンティック検索を提供しています。ピーク時（セール期間）には同時検索リクエストが通常の10倍に増加し、検索レイテンシーが500msを超えて顧客体験に影響しています。CloudWatch メトリクスでは、ライターインスタンスの CPU 使用率が90%を超えています。要件として、(1) ピーク時でも検索レイテンシーを100ms以内に維持すること、(2) コスト効率の良い方法で対応すること、が求められています。パフォーマンスを改善するために有効な方法を2つ選択してください。",
  "options": [
    {
      "id": "A",
      "text": "pgvector の HNSW インデックスを作成して近似最近傍検索（ANN）を有効化する。HNSW はグラフベースのアルゴリズムで、30万件規模のベクトルに対して網羅的な全探索（逐次スキャン）と比較して検索速度を数十倍に改善でき、個々のクエリレイテンシーを大幅に削減する"
    },
    {
      "id": "B",
      "text": "Aurora のリーダーインスタンスを追加し、アプリケーション側でリーダーエンドポイントを使用して検索クエリを読み取りレプリカに分散させる。ライターインスタンスの CPU 負荷を軽減し、同時検索クエリの処理能力を水平にスケールする"
    },
    {
      "id": "C",
      "text": "埋め込みモデルの出力次元数を現在の1024から2048に増やして検索精度を向上させる。次元数が増えると意味的表現力が向上し、より正確な類似度計算が可能になるため、上位結果の関連性が高まりレイテンシーが改善される"
    },
    {
      "id": "D",
      "text": "Aurora のインスタンスクラスを現在の db.r6g.xlarge から db.r6g.16xlarge にスケールアップし、CPU コア数とメモリを最大化する。より多くのコンピュートリソースでベクトル検索の計算処理を高速化する"
    },
    {
      "id": "E",
      "text": "pgvector の IVFFlat インデックスの probes パラメータを現在の1から50に大幅に増やし、探索するクラスタ数を増やして検索精度を向上させる。精度が向上すれば関連性の低い結果の再検索が不要になりトータルのレイテンシーが改善される"
    }
  ],
  "correctAnswers": [
    "A",
    "B"
  ],
  "explanation": "A: pgvector の HNSW インデックスは、ベクトルの近似最近傍検索をグラフベースのアルゴリズムで高速化します。インデックスなしの逐次スキャンと比較して検索速度が数十倍向上し、個々のクエリレイテンシーを大幅に改善できます。B: Aurora のリーダーインスタンスの追加により、検索クエリ（読み取り専用）をリーダーエンドポイント経由で読み取りレプリカに分散できます。ライターインスタンスの CPU 使用率90%という負荷を軽減し、ピーク時の10倍の同時リクエストにも水平スケーリングで対応できます。次元数の増加（C）はベクトル1つあたりのデータサイズとインデックスサイズが2倍になり、メモリ使用量と計算量が増加するため、レイテンシーが悪化します。次元数は精度に影響しますがレイテンシーの改善にはなりません。インスタンスの最大サイズへのスケールアップ（D）はコストが大幅に増加し（16xlarge は xlarge の16倍のコスト）、HNSW インデックスの作成とリーダーインスタンスの追加の方がコスト効率が良く効果的です。IVFFlat の probes 増加（E）は探索するクラスタ数を増やすため検索精度は向上しますが、計算量も比例して増加するため、レイテンシーが悪化します。probes を50に設定するとほぼ全クラスタを探索することになり、逐次スキャンに近い計算量となります。（スキル1.5.3）",
  "optionExplanations": {
    "A": {
      "correct": true,
      "text": "正解です。HNSW インデックスによる近似最近傍検索は、逐次スキャンと比較して検索速度を数十倍に改善し、個々のクエリレイテンシーの大幅削減の要件を直接満たします。インデックス作成のみでパフォーマンスを向上でき、コスト効率も良好です。"
    },
    "B": {
      "correct": true,
      "text": "正解です。リーダーインスタンスの追加により検索クエリを読み取りレプリカに分散し、ライターの CPU 使用率90%の負荷を軽減できます。ピーク時の10倍の同時リクエストに水平スケーリングで対応でき、コスト効率の良いスループット向上を実現します。"
    },
    "C": {
      "correct": false,
      "text": "不正解です。次元数を1024から2048に増やすとベクトルのデータサイズとインデックスサイズが2倍になり、メモリ使用量と距離計算のコストが増加してレイテンシーが悪化します。次元数の増加は検索精度に影響しますが、レイテンシーの改善にはならず要件と矛盾します。"
    },
    "D": {
      "correct": false,
      "text": "不正解です。db.r6g.16xlarge へのスケールアップはCPUリソースを増加させますが、コストが xlarge の約16倍になります。HNSW インデックスの作成（アルゴリズムの最適化）とリーダーインスタンスの追加（水平スケーリング）の方がコスト効率が良く、同等以上のパフォーマンス改善が可能です。"
    },
    "E": {
      "correct": false,
      "text": "不正解です。IVFFlat の probes パラメータを50に増やすと、探索するクラスタ数が増えて計算量が比例して増加し、レイテンシーが悪化します。probes を大幅に増やすとほぼ全クラスタを探索するため逐次スキャンに近い計算量となり、インデックスの効果が失われます。"
    }
  },
  "references": [
    {
      "title": "Aurora PostgreSQL pgvector",
      "url": "https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/AuroraPostgreSQL.Extensions.html"
    },
    {
      "title": "Amazon Aurora リードレプリカ",
      "url": "https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/Aurora.Replication.html"
    }
  ]
});
