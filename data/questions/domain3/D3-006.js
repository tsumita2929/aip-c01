window.DOMAIN3_QUESTIONS = window.DOMAIN3_QUESTIONS || [];
window.DOMAIN3_QUESTIONS.push({
  "id": "D3-006",
  "domain": 3,
  "task": "3.1",
  "skill": "3.1.2",
  "type": "multiple",
  "difficulty": "hard",
  "question": "ある企業が、Amazon Bedrock を使用してデータベースに対する自然言語クエリインターフェース（Text-to-SQL）を構築しています。ユーザーが自然言語で質問すると、基盤モデルがSQL文を生成して Amazon RDS データベースに実行します。生成されたSQLが意図しないデータ変更や削除を行わないようにするため、出力安全性を確保する適切な対策を2つ選択してください。",
  "options": [
    {
      "id": "A",
      "text": "Amazon Bedrock ガードレールの拒否トピックに「データ変更」「削除」などのトピックを定義し、ユーザー入力から危険な意図を検出してブロックする"
    },
    {
      "id": "B",
      "text": "生成されたSQLに対して構文解析（パース）による決定論的な検証を実施し、SELECT文のみを許可してDELETE、UPDATE、DROP等のステートメントを含むクエリをブロックするバリデーションレイヤーを実装する"
    },
    {
      "id": "C",
      "text": "基盤モデルのシステムプロンプトに「SELECT文のみを生成し、DELETE/UPDATE/DROP文は絶対に生成しないでください」と指示を追加する"
    },
    {
      "id": "D",
      "text": "Amazon RDS のデータベース接続ユーザーの権限を読み取り専用（SELECT権限のみ）に設定し、書き込み操作をデータベースレベルで拒否する"
    },
    {
      "id": "E",
      "text": "Amazon RDS のスロークエリログを有効化し、実行されたSQL文を CloudWatch Logs に記録して事後分析する"
    }
  ],
  "correctAnswers": [
    "B",
    "D"
  ],
  "explanation": "Text-to-SQL システムの出力安全性確保には複数の独立したレイヤーが有効です。B の構文解析による決定論的 SQL 検証は、アプリケーション層で SQL 文をパースし、許可されたステートメントタイプ（SELECT のみ）のホワイトリスト検証により意図しないデータ変更を確実に防止します。D のデータベースユーザー権限の制限は、万が一アプリケーション層の検証を通過した場合のセーフティネットとして、データベースレベルで書き込み操作を拒否します。A のガードレール拒否トピックは自然言語の意図検出であり、「先月の売上データを更新後の値に修正して」のような複雑な表現でのデータ変更意図を完全に検出できる保証はなく、生成された SQL 文自体の検証ではありません。C のシステムプロンプト指示は補助的ですが、プロンプトインジェクションやモデルの誤動作により無視される可能性があり、確実な対策とは言えません。E のスロークエリログは事後的な記録であり、意図しない変更自体を防止できません。（スキル3.1.2）",
  "optionExplanations": {
    "A": {
      "correct": false,
      "text": "不正解です。ガードレールの拒否トピックは自然言語の意図検出であるものの、複雑な表現でのデータ変更意図を完全に検出できる保証がなく、生成された SQL 文自体の検証ではないため、確実な出力安全性という要件を満たしません。"
    },
    "B": {
      "correct": true,
      "text": "正解です。構文解析による決定論的 SQL 検証で SELECT 文のみをホワイトリスト検証し、意図しないデータ変更を確実に防止するアプリケーション層の対策であり、出力安全性を直接満たします。"
    },
    "C": {
      "correct": false,
      "text": "不正解です。システムプロンプト指示は補助的であるものの、プロンプトインジェクションやモデルの誤動作により無視される可能性があり、確実な出力安全性対策という要件を満たしません。"
    },
    "D": {
      "correct": true,
      "text": "正解です。データベースユーザー権限を読み取り専用に制限し、アプリケーション層の検証を通過した場合のセーフティネットとしてデータベースレベルで防御することで、出力安全性を直接満たします。"
    },
    "E": {
      "correct": false,
      "text": "不正解です。スロークエリログは実行された SQL の監査には有用であるものの、事後的な記録・分析にとどまり意図しないデータ変更の発生自体を防止することはできないため、出力安全性の確保という要件を満たしません。"
    }
  },
  "references": [
    {
      "title": "Amazon Bedrock Security Best Practices",
      "url": "https://docs.aws.amazon.com/bedrock/latest/userguide/security-best-practices.html"
    },
    {
      "title": "Amazon Bedrock Guardrails",
      "url": "https://docs.aws.amazon.com/bedrock/latest/userguide/guardrails.html"
    }
  ]
});
