window.DOMAIN4_QUESTIONS = window.DOMAIN4_QUESTIONS || [];
window.DOMAIN4_QUESTIONS.push({
  "id": "D4-001",
  "domain": 4,
  "task": "4.1",
  "skill": "4.1.1",
  "type": "single",
  "difficulty": "easy",
  "question": "ある企業が Amazon Bedrock 上で Claude モデルを使用した社内ナレッジチャットボットを運用しています。月間のトークン使用量が急増しており、分析の結果、長い会話履歴をすべてプロンプトに含めて送信していることが主因と判明しました。1回のリクエストあたり平均12,000トークンを消費しており、そのうち約70%が過去の会話履歴です。コストを削減しつつ、ユーザーへの応答品質を維持し、運用負荷を最小限に抑える必要があります。最も効果的なアプローチはどれですか。",
  "options": [
    {
      "id": "A",
      "text": "会話履歴の要約機能を実装し、過去の会話を軽量モデル（Claude 3 Haiku）で要約してからメインモデルのプロンプトに含める。要約結果は Amazon DynamoDB に保存してセッション間で再利用する"
    },
    {
      "id": "B",
      "text": "モデルをより大きなコンテキストウィンドウを持つ上位モデルにアップグレードし、Amazon ElastiCache で全会話履歴をキャッシュして高速に取得する"
    },
    {
      "id": "C",
      "text": "プロビジョンドスループットを購入してトークン単価を下げつつ、AWS Lambda でリクエストを並列化して処理速度を向上させる"
    },
    {
      "id": "D",
      "text": "レスポンスの最大トークン数を50トークンに制限し、Amazon API Gateway のスロットリング設定でリクエスト数自体を抑制する"
    }
  ],
  "correctAnswers": [
    "A"
  ],
  "explanation": "正解はAです。会話履歴の要約機能により、過去の会話を軽量モデル（Haiku）で要約してからメインモデルに渡すことで、入力トークン数を大幅に削減できます。Haiku による要約コストは元の12,000トークンの入力コストと比較して大幅に低く、DynamoDB に要約を保存することでセッション再開時にも再利用でき、運用効率が高まります。Bはモデルアップグレードによりトークン単価が上がり、ElastiCache で全会話履歴をキャッシュしても送信トークン数自体は削減されないため、コスト削減の要件を満たしません。Cのプロビジョンドスループットは単価を下げる効果がありますが、根本的なトークン浪費（70%が不要な履歴）を解決せず、Lambda 並列化もトークンコスト削減には寄与しません。Dは50トークンの制限が極端すぎて意味のある応答を生成できず、API Gateway のスロットリングは可用性を損ないます。",
  "optionExplanations": {
    "A": {
      "correct": true,
      "text": "正解です。軽量モデルによる会話履歴の要約と DynamoDB への保存は、トークンコスト削減・応答品質維持・運用負荷最小化のすべてを満たします。過去の会話を要約することで入力トークン数を70%以上削減しつつ、要約により文脈情報を維持できます。"
    },
    "B": {
      "correct": false,
      "text": "不正解です。上位モデルへのアップグレードはコンテキストウィンドウが広がるものの、トークン単価が高くなりコストが増加します。ElastiCache による会話履歴のキャッシュは取得速度を改善しますが、送信するトークン数自体は削減されないため、コスト削減の要件を満たしません。"
    },
    "C": {
      "correct": false,
      "text": "不正解です。プロビジョンドスループットはトークン単価を下げますが、1リクエストあたり12,000トークンのうち70%が不要な会話履歴という根本原因を解決しません。Lambda 並列化は処理速度向上には寄与しますがトークン効率の改善にはなりません。"
    },
    "D": {
      "correct": false,
      "text": "不正解です。レスポンスを50トークンに制限すると意味のある回答が生成できず、応答品質維持の要件を満たしません。API Gateway のスロットリングはサービスの可用性を損ない、ユーザー体験が大幅に悪化します。"
    }
  },
  "references": [
    {
      "title": "Amazon Bedrock の推論パラメータ",
      "url": "https://docs.aws.amazon.com/bedrock/latest/userguide/inference-parameters.html"
    },
    {
      "title": "Amazon Bedrock プロンプトエンジニアリングガイドライン",
      "url": "https://docs.aws.amazon.com/bedrock/latest/userguide/prompt-engineering-guidelines.html"
    }
  ]
});
