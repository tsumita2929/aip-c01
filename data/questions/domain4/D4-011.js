window.DOMAIN4_QUESTIONS = window.DOMAIN4_QUESTIONS || [];
window.DOMAIN4_QUESTIONS.push({
  "id": "D4-011",
  "domain": 4,
  "task": "4.2",
  "skill": "4.2.3",
  "type": "multiple",
  "difficulty": "hard",
  "question": "ある大規模 SaaS 企業が Amazon Bedrock を使用して、数千の企業顧客に対して同時に AI 機能を提供しています。ピーク時には1分あたり10,000件以上のリクエストが発生し、オンデマンドスループットの制限によるスロットリングが頻発しています。各テナントのリクエストには優先度の差があり、プレミアム顧客のリクエストは通常顧客よりも優先的に処理する必要があります。スループットを効果的に最適化しながらテナント間の公平性を確保するために有効なアプローチを2つ選択してください。",
  "options": [
    {
      "id": "A",
      "text": "入力プロンプトの最適化（不要なコンテキスト削除・プロンプト圧縮）を全テナントに適用し、1リクエストあたりの処理時間を短縮することで実効スループットを向上させる"
    },
    {
      "id": "B",
      "text": "Amazon SQS の FIFO キューにすべてのリクエストを送信し、到着順に厳密に処理してテナント間の公平性を確保する"
    },
    {
      "id": "C",
      "text": "プレミアム顧客用にプロビジョンドスループットを確保し、通常顧客にはオンデマンドスループットを使用する。Amazon API Gateway の使用量プランとスロットリング設定でテナント別のレート制限を実装する"
    },
    {
      "id": "D",
      "text": "複数の AWS リージョンにアプリケーションを展開し、Amazon Route 53 のレイテンシーベースルーティングで地理的に最も近いリージョンに振り分ける"
    },
    {
      "id": "E",
      "text": "すべてのリクエストに対してプロビジョンドスループットの6か月コミットメントを購入し、最大ピーク時のトラフィック量に合わせた固定容量を確保する"
    }
  ],
  "correctAnswers": [
    "A",
    "C"
  ],
  "explanation": "正解はAとCです。Aのプロンプト最適化により、不要なコンテキスト削除やプロンプト圧縮を全テナントに適用することで、1リクエストあたりの処理時間が短縮され、同じスループット枠内でより多くのリクエストを処理できます。これは追加コストなしで実効スループットを向上させる基本的な手法です。Cのプロビジョンドスループット + API Gateway 使用量プランの組み合わせにより、プレミアム顧客には専用の高スループットを保証しつつ、テナント別のレート制限で公平性を確保できます。Bの FIFO キューは到着順処理であり、プレミアム顧客の優先処理ができません。Dのマルチリージョン展開はレイテンシー最適化には有効ですが、各リージョンのスループット制限は独立しているためスロットリング問題の根本解決にはならず、テナント優先度の制御もできません。Eは全リクエスト分のプロビジョンドスループットを最大ピークに合わせて購入するため、オフピーク時のコスト浪費が大きく、コスト効率の要件を満たしません。（スキル: 4.2.3）",
  "optionExplanations": {
    "A": {
      "correct": true,
      "text": "正解です。プロンプト最適化は追加コストなしで実効スループットを向上させる基本手法です。不要なコンテキスト削除やプロンプト圧縮により1リクエストあたりの処理時間を短縮し、同じスループット枠内でより多くのリクエストを処理できます。"
    },
    "B": {
      "correct": false,
      "text": "不正解です。FIFO キューによる到着順処理は厳密な順序保証には有効ですが、プレミアム顧客の優先処理ができず、テナント間の優先度制御の要件を満たしません。また順次処理ではスループット向上に寄与しません。"
    },
    "C": {
      "correct": true,
      "text": "正解です。プレミアム顧客用のプロビジョンドスループットにより専用のスループットが保証され、API Gateway の使用量プランによるテナント別レート制限で公平性を確保できます。スループット最適化とテナント優先度制御の両方を満たします。"
    },
    "D": {
      "correct": false,
      "text": "不正解です。マルチリージョン展開はエンドユーザーへのレイテンシー短縮には有効ですが、各リージョンのスループット制限は独立しているため、スロットリング問題の根本解決にはなりません。テナント優先度の制御機能も提供しません。"
    },
    "E": {
      "correct": false,
      "text": "不正解です。最大ピーク時に合わせた固定容量の6か月コミットメントは、スロットリング解消には有効ですが、オフピーク時に大量の未使用容量が発生しコスト効率が著しく低下します。テナント間の優先度制御も実現できません。"
    }
  },
  "references": [
    {
      "title": "Amazon Bedrock のクォータ",
      "url": "https://docs.aws.amazon.com/bedrock/latest/userguide/quotas.html"
    },
    {
      "title": "Amazon Bedrock プロビジョンドスループット",
      "url": "https://docs.aws.amazon.com/bedrock/latest/userguide/prov-throughput.html"
    },
    {
      "title": "Amazon API Gateway 使用量プラン",
      "url": "https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-api-usage-plans.html"
    }
  ]
});
